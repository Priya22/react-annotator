(window.webpackJsonpannotator=window.webpackJsonpannotator||[]).push([[0],{48:function(e,t,a){e.exports=a(79)},53:function(e,t,a){},75:function(e,t,a){},76:function(e,t,a){},79:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),i=a(24),r=a.n(i),o=a(23),l=a(5),c=a(4),u=a(6),d=a(7),p=a(8),h=a(12),m=a(28),f=a(2),b=(a(53),a(99)),v=a(98),E=a(100),_=a(101),k=a(25),g=a.n(k),y=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={hasError:!1},a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return this.state.hasError?s.a.createElement("h2",null,"An Unfortuante Error has occured. Please refresh!"):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),t}(n.Component),S=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"loader"},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"heading"},s.a.createElement("h1",null,"Quote Annotation Tool ")),s.a.createElement(y,null,s.a.createElement(x,null))))}}]),t}(s.a.Component);function O(e){return e.replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))}function j(e){var t={};return e.forEach((function(e,a){t[e.name]=e.id,e.expand.forEach((function(a){t[a.name]=e.id}))})),t}function C(e){var t={};return e.forEach((function(e){t[e.id]=e.name})),t}var x=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={cur_file:"",content:"",data:"",charList:""},a.handleUpload=a.handleUpload.bind(Object(f.a)(a)),a.reloadState=a.reloadState.bind(Object(f.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"reloadState",value:function(e){!0===window.confirm("Please save before you proceed!")&&this.setState({cur_file:"",content:"",data:"",charList:""})}},{key:"handleUpload",value:function(e){var t=this,a=new FileReader,n=this,s=e.target.files[0].name;console.log(e.target.files[0]),g.a.get("http://127.0.0.1:8080/data",{params:{file_name:s}}).then((function(e){t.setState({cur_file:e.data.title,content:e.data.content,data:e.data.data,charList:e.data.charList})})),a.onloadend=function(){var e=a.result;n.setState({file_ext:".txt",content:e})},a.readAsText(e.target.files[0])}},{key:"render",value:function(){return""===this.state.cur_file?s.a.createElement("div",{className:"content"},s.a.createElement(w,{handleUpload:this.handleUpload}),s.a.createElement("p",{style:{background:"white","text-align":"center",border:"none"}},s.a.createElement("i",null,s.a.createElement("strong",null,"Note: "),"This is a friendly reminder to keep your character lists updated!",s.a.createElement("br",null)," Copy the ")," xx_chars.json ",s.a.createElement("i",null,"file over if you are starting the next part of a previously annotated text."))):s.a.createElement("div",{className:"content"},s.a.createElement(N,{value:this.state.cur_file}),s.a.createElement(R,{value:this.state.content,data:this.state.data,charList:this.state.charList,reloadState:this.reloadState,fileName:this.state.cur_file}))}}]),t}(s.a.Component);function w(e){return s.a.createElement("div",{id:"load",className:"default"},s.a.createElement("h3",{className:"init-heading"}," Load a text file: "),s.a.createElement("input",{type:"file",id:"loadfiles",accept:".txt",onChange:e.handleUpload,multiple:!0}))}function N(e){return s.a.createElement("div",{id:"text-heading"},s.a.createElement("h1",null,e.value))}var R=function(e){function t(e){var a;Object(l.a)(this,t);var n=(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).props.data,s=a.props.charList,i=a.props.value;return a.state={content:i,charList:s,current_sel:"",sel_type:"quotes",locked:!1,confirmed:!1,cur_info:{},selectedRows:[],selectedSpanIds:[],cur_mode:"normal",cur_ref_exp:"",men_ranges:n.men_ranges,men_infos:n.men_infos,men_span_ids:n.men_span_ids,quote_ranges:n.quote_ranges,quote_infos:n.quote_infos,quote_span_ids:n.quote_span_ids},a.clearSel=a.clearSel.bind(Object(f.a)(a)),a.addToRanges=a.addToRanges.bind(Object(f.a)(a)),a.setSelection=a.setSelection.bind(Object(f.a)(a)),a.processSelection=a.processSelection.bind(Object(f.a)(a)),a.updateChars=a.updateChars.bind(Object(f.a)(a)),a.infoSubmit=a.infoSubmit.bind(Object(f.a)(a)),a.onSpanClick=a.onSpanClick.bind(Object(f.a)(a)),a.confirmSelection=a.confirmSelection.bind(Object(f.a)(a)),a.setField=a.setField.bind(Object(f.a)(a)),a.updateSelectedRows=a.updateSelectedRows.bind(Object(f.a)(a)),a.updateMode=a.updateMode.bind(Object(f.a)(a)),a.setSelectionType=a.setSelectionType.bind(Object(f.a)(a)),a.handleSelChange=a.handleSelChange.bind(Object(f.a)(a)),a.saveCurrent=a.saveCurrent.bind(Object(f.a)(a)),a.checkCompatible=a.checkCompatible.bind(Object(f.a)(a)),a.checkArrayEqual=a.checkArrayEqual.bind(Object(f.a)(a)),a.mergeChars=a.mergeChars.bind(Object(f.a)(a)),a.getSpanInfo=a.getSpanInfo.bind(Object(f.a)(a)),a.getNumAnnotations=a.getNumAnnotations.bind(Object(f.a)(a)),a.getCharDicts=a.getCharDicts.bind(Object(f.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"getCharDicts",value:function(){for(var e=this.state.quote_infos,t=this.state.men_infos,a={},n={},s=function(){var e=r[i],t=(o=Object(m.a)(e,2))[0],n=o[1];n.speaker.forEach((function(e){e in a?a[e].push(t):a[e]=[t]})),n.speakee.forEach((function(e){e in a?a[e].push(t):a[e]=[t]}))},i=0,r=Object.entries(e);i<r.length;i++){var o;s()}for(var l=function(){var e=u[c],t=(d=Object(m.a)(e,2))[0];d[1].speakee.forEach((function(e){e in n?n[e].push(t):n[e]=[t]}))},c=0,u=Object.entries(t);c<u.length;c++){var d;l()}return{quote:a,mention:n}}},{key:"checkArrayEqual",value:function(e,t){if(0===e.length&&0===t.length)return!0;if(e.length!==t.length)return!1;e.sort(),t.sort();for(var a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0}},{key:"checkCompatible",value:function(e,t){var a="quotes"===this.state.sel_type?this.state.quote_infos:this.state.men_infos;if(0===e.length)return!0;var n=a[e[0]],s=a[t];return console.log("Compatibility: "),console.log(n),console.log(s),!(!this.checkArrayEqual(n.speakee,s.speakee)||!this.checkArrayEqual(n.speaker,s.speaker)||n.quote_type!==s.quote_type||n.ref_exp!==s.ref_exp)}},{key:"onSpanClick",value:function(e){var t=e.target.id,a=this.state.content,n="quotes"===this.state.sel_type?this.state.quote_ranges:this.state.men_ranges;console.log("Span clicked"),console.log(t,typeof t),console.log(a.substring(n[t].start,n[t].end));var s=this.state.selectedSpanIds;if(s.includes(t))s=s.filter((function(e){return e!==t}));else{if(!this.checkCompatible(s,t))return void A("Incompatible Selections!",3e3);s.push(t)}var i="",r=!0,o=!1,l=void 0;try{for(var c,u=s[Symbol.iterator]();!(r=(c=u.next()).done);r=!0){var d=c.value,p=a.substring(n[d].start,n[d].end);console.log(d,p),i+=p,i+="; "}}catch(b){o=!0,l=b}finally{try{r||null==u.return||u.return()}finally{if(o)throw l}}var h={},m=this.state.confirmed;s.length>0&&""!==(h=this.getSpanInfo(s[s.length-1])).quote_type&&(m=!0);var f=!0;m=!0,0===s.length&&(f=!1),this.setState({selectedSpanIds:s,current_sel:i,cur_info:h,confirmed:m,locked:f})}},{key:"processSelection",value:function(){console.log("Processing selections");for(var e=[],t=[],a=[],n="quotes"===this.state.sel_type?this.state.quote_ranges:this.state.men_ranges,s="quotes"===this.state.sel_type?this.state.quote_infos:this.state.men_infos,i="quotes"===this.state.sel_type?this.state.quote_span_ids:this.state.men_span_ids,r=Object.keys(n).map((function(e){return n[e].end})),o=this.state.content,l=Math.max.apply(null,r),c=Math.min(o.length,l),u=0,d=0;u<c;){var p=i[d];if(u<n[p].start){var h=o.substring(u,n[p].start);e.push(h),t.push("normal-text"),a.push(""),u=n[p].start}else if(u===n[p].start){var m="",f=o.substring(n[p].start,n[p].end);this.state.selectedSpanIds.includes(String(p))?m=this.state.confirmed?"confirmed-quote":"selected-quote":"Quote"===s[p].sel_type&&""===s[p].quote_type?m="identified-quote":"Mention"===s[p].sel_type?(m="identified-quote",s[p].speakee.length>0&&(m="annotated-quote")):m=s[p].quote_type.toLowerCase()+"-quote",e.push(f),t.push(m),a.push(p),u=n[p].end,d+=1}}return u<o.length&&(e.push(o.substring(u,o.length)),t.push("normal-text"),a.push("")),{texts:e,classes:t,ids:a}}},{key:"handleSelChange",value:function(e){if(console.log(e.target.id),0!==this.state.selectedSpanIds.length)alert("Please finish current annotation to switch tabs!"),e.preventDefault();else{var t=e.target.id;t===this.state.sel_type?e.preventDefault():(this.setState({sel_type:t}),e.preventDefault())}}},{key:"addToRanges",value:function(e,t){console.log("Adding selection to ranges: ");var a="quotes"===this.state.sel_type?this.state.quote_ranges:this.state.men_ranges,n="quotes"===this.state.sel_type?this.state.quote_infos:this.state.men_infos,s="quotes"===this.state.sel_type?this.state.quote_span_ids:this.state.men_span_ids,i=this.props.value.substring(e,t),r=Math.max.apply(null,s)+1;console.log(r),a[String(r)]={start:e,end:t};var o={speaker:[],speakee:[],ref_exp:"",quote_type:"",sel_type:"quotes"===this.state.sel_type?"Quote":"Mention",text:i};n[String(r)]=o,s.push(String(r)),s.sort((function(e,t){return a[e].start-a[t].start})),"quotes"===this.state.sel_type?this.setState({quote_ranges:a,quote_infos:n,cur_info:{},quote_span_ids:s,locked:!1,current_sel:"",confirmed:!1,cur_mode:"normal"}):this.setState({men_ranges:a,men_infos:n,cur_info:{},men_span_ids:s,locked:!1,current_sel:"",confirmed:!1,cur_mode:"normal"})}},{key:"confirmSelection",value:function(e){if(!1===this.state.confirmed){var t=this.state.selectedSpanIds[0],a="quotes"===this.state.sel_type?this.state.quote_infos[t]:this.state.men_infos[t];this.setState({confirmed:!0,locked:!0,cur_info:a})}e.preventDefault()}},{key:"setSelection",value:function(e,t){var a=this.props.value.substring(e,t);console.log(a),"ref_exp"!==this.state.cur_mode?this.addToRanges(e,t):this.setState({cur_ref_exp:a})}},{key:"clearSel",value:function(e){var t=this.state.selectedSpanIds,a="quotes"===this.state.sel_type?this.state.quote_ranges:this.state.men_ranges,n="quotes"===this.state.sel_type?this.state.quote_infos:this.state.men_infos,s="quotes"===this.state.sel_type?this.state.quote_span_ids:this.state.men_span_ids,i=!0,r=!1,o=void 0;try{for(var l,c=t[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var u=l.value;delete a[u],delete n[u]}}catch(d){r=!0,o=d}finally{try{i||null==c.return||c.return()}finally{if(r)throw o}}s=s.filter((function(e){return!t.includes(String(e))})),console.log("Clearing filter: "),"quotes"===this.state.sel_type?(this.setState({quote_ranges:a,quote_infos:n,quote_span_ids:s,selectedSpanIds:[],current_sel:"",cur_info:{},locked:!1,cur_mode:"normal"}),e.preventDefault()):(this.setState({men_ranges:a,men_infos:n,men_span_ids:s,selectedSpanIds:[],current_sel:"",cur_info:{},locked:!1,cur_mode:"normal"}),e.preventDefault())}},{key:"infoSubmit",value:function(e){var t=this,a=this.state.selectedSpanIds,n="quotes"===this.state.sel_type?this.state.quote_infos:this.state.men_infos,s=this.state.cur_info,i=!0,r=!1,o=void 0;try{for(var l,c=a[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){n[l.value]=s}}catch(u){r=!0,o=u}finally{try{i||null==c.return||c.return()}finally{if(r)throw o}}"quotes"===this.state.sel_type?this.setState({selectedSpanIds:[],quote_infos:n,cur_info:{},confirmed:!1,locked:!1,cur_mode:"normal",current_sel:""},(function(){return t.saveCurrent(e)})):this.setState({selectedSpanIds:[],men_infos:n,cur_info:{},confirmed:!1,locked:!1,cur_mode:"normal",current_sel:""},(function(){return t.saveCurrent(e)}))}},{key:"updateSelectedRows",value:function(e){this.setState({selectedRows:e})}},{key:"setField",value:function(e,t){var a=this,n=this.state.cur_info;if("speaker"===e){var s=this.state.selectedRows;n.speaker=s,this.setState({cur_info:n,cur_mode:"normal",selectedRows:[]})}else if("speakee"===e){var i=this.state.selectedRows;n.speakee=i,this.setState({cur_info:n,cur_mode:"normal",selectedRows:[]})}else if("ref_exp"===e)n.ref_exp=this.state.cur_ref_exp,this.setState({locked:!0,cur_mode:"normal",cur_info:n,cur_ref_exp:""}),window.getSelection().empty();else if("quote_type"===e)n.quote_type=t,"Implicit"===t&&(n.ref_exp=""),this.setState({cur_info:n,cur_mode:"normal"});else if("merge-chars"===e){var r=this.state.selectedRows,o=this.mergeChars(r),l=Object(m.a)(o,3),c=l[0],u=l[1],d=l[2];this.setState({charList:c,quote_infos:u,men_infos:d,cur_mode:"normal",selectedRows:[]},(function(){return a.saveCurrent()}))}}},{key:"updateMode",value:function(e){var t=this.state.selectedRows;"speaker"===e?(t=this.state.cur_info.speaker,this.setState({cur_mode:e,selectedRows:t})):"speakee"===e?(t=this.state.cur_info.speakee,this.setState({cur_mode:e,selectedRows:t})):"merge"===e?(t=[],this.setState({cur_mode:e,selectedRows:t})):(t=[],"ref_exp"===e?this.setState({cur_mode:e,selectedRows:t,locked:!1,cur_ref_exp:""}):this.setState({cur_mode:e,selectedRows:t}))}},{key:"updateInfos",value:function(e,t,a,n){var s=0,i=0,r=this.getCharDicts(),o=r.quote,l=r.mention;return e.id in o&&o[e.id].forEach((function(n){a[n].speaker=a[n].speaker.map((function(a){return a===e.id?(s+=1,t.id):a})),a[n].speakee=a[n].speakee.map((function(a){return a===e.id?(s+=1,t.id):a}))})),e.id in l&&l[e.id].forEach((function(a){n[a].speakee=n[a].speakee.map((function(a){return a===e.id?(i+=1,t.id):a}))})),[a,n,s,i]}},{key:"mergeChars",value:function(e){var t=JSON.parse(JSON.stringify(this.state.quote_infos)),a=JSON.parse(JSON.stringify(this.state.men_infos)),n=0,s=0,i=this.state.charList,r=[],o=[],l=i.filter((function(t,a){var n=e.includes(t.id);return n&&(o.push(a),r.push(t)),!n}));o=o[0];for(var c=r[0],u=1;u<r.length;u++){var d=r[u],p=this.updateInfos(d,c,t,a),h=Object(m.a)(p,4);t=h[0],a=h[1],n+=h[2],s+=h[3];var f={name:d.name,parent:c.id};c.expand.push(f);for(var b=0;u<d.expand.length;b++){f={name:d.expand[b].name,parent:c.id},c.expand.push(f)}}l.splice(o,0,c);var v=!0;return 0===n&&0===s||(v=window.confirm("Changing information for: "+n+" quotes, "+s+" mentions.")),!0===v?[l,t,a]:[i,this.state.qinfos,this.state.minfos]}},{key:"getNumAnnotations",value:function(e){var t=this.getCharDicts(),a=0;return e in t.quote&&(a+=t.quote[e].length),e in t.mention&&(a+=t.mention[e].length),a}},{key:"updateChars",value:function(e){var t=this;console.log("Updating charList in ContentBox."),console.log("Sorting: "),e.sort((function(e,t){return e.name>t.name?1:-1})),this.setState({charList:e},(function(){return t.saveCurrent()}))}},{key:"getSpanInfo",value:function(e){return("quotes"===this.state.sel_type?this.state.quote_infos:this.state.men_infos)[e]}},{key:"setSelectionType",value:function(e){var t=e.target.value,a=this.state.cur_info;a.sel_type=t,this.setState({cur_info:a})}},{key:"saveCurrent",value:function(){var e={file_name:this.props.fileName,charList:this.state.charList,men_ranges:this.state.men_ranges,men_infos:this.state.men_infos,men_span_ids:this.state.men_span_ids,quote_ranges:this.state.quote_ranges,quote_infos:this.state.quote_infos,quote_span_ids:this.state.quote_span_ids};console.log("SAVING STATE: "),g.a.post("http://127.0.0.1:8080/data",e).then((function(e){200===e.status?A("Annotation Saved!",3e3):alert("Save failed.")}))}},{key:"render",value:function(){var e=this,t=j(this.state.charList),a=C(this.state.charList);if(""===this.props.value)return s.a.createElement("div",{id:"annotationareacontainer"},s.a.createElement("div",{id:"annotationarea"},s.a.createElement("pre",{id:"input-text",className:"lined"},this.props.value)));var n=this.processSelection(),i=0!==this.state.selectedSpanIds.length,r="mentions"===this.state.sel_type?"side-button":"side-button-selected",o="quotes"===this.state.sel_type?"side-button":"side-button-selected";return s.a.createElement("div",{id:"save-option"},s.a.createElement("div",{id:"context-switch"},s.a.createElement("span",{id:"instructions"},s.a.createElement("a",{style:{display:"table-cell"},href:"https://docs.google.com/document/d/1eBsX2rjdLBkmA-kWB_jHCxC1nmbzinH04WUg9PeN_2A/edit?usp=sharing",target:"_blank"},"Instructions")),s.a.createElement("span",{id:"mentions-button"},s.a.createElement("button",{name:"switch-mentions",id:"mentions",className:o,onClick:this.handleSelChange},"Mentions")),s.a.createElement("span",{id:"quotes-button"},s.a.createElement("button",{name:"switch-quotes",id:"quotes",className:r,onClick:this.handleSelChange},"Quotes"))),s.a.createElement("div",{id:"annotationareacontainer"},s.a.createElement(q,{updateChars:this.updateChars,charList:this.state.charList,id2char:a,char2id:t,selectedRows:this.state.selectedRows,updateSelectedRows:this.updateSelectedRows,getNumAnnotations:this.getNumAnnotations,setSelectionType:this.setSelectionType,sel_type:this.state.sel_type,selected_text:this.state.current_sel,clearSel:this.clearSel,confirmSelection:this.confirmSelection,confirmed:this.state.confirmed,cur_info:this.state.cur_info,infoSubmit:this.infoSubmit,setField:this.setField,cur_mode:this.state.cur_mode,updateMode:this.updateMode}),s.a.createElement(I,{value:n,charList:this.props.charList,id2char:a,char2id:t,locked:this.state.locked,setSelection:function(t,a){return e.setSelection(t,a)},onSpanClick:this.onSpanClick,clickEnabled:!0!==this.state.confirmed,getSpanInfo:this.getSpanInfo})),s.a.createElement("div",{id:"save-button"},s.a.createElement("span",null,s.a.createElement("button",{className:"css-button",type:"submit",name:"save-current",disabled:i,onClick:this.saveCurrent},"Save Progress")),s.a.createElement("span",null,s.a.createElement("button",{className:"css-button",type:"submit",name:"clear-current",disabled:i,onClick:this.props.reloadState},"Reload Page"))))}}]),t}(s.a.Component);function A(e,t){var a=document.createElement("div");a.setAttribute("style","position:absolute;top:40%;left:20%;background-color:white;font-size:xx-large"),a.innerHTML=e,setTimeout((function(){a.parentNode.removeChild(a)}),t),document.body.appendChild(a)}var q=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return console.log("Collect: "),console.log(this.props.cur_info),0!==this.props.selected_text.length?"Quote"===this.props.cur_info.sel_type?s.a.createElement("div",{id:"collect"},s.a.createElement("div",{id:"charnames"},s.a.createElement("h3",null,"Characters"),s.a.createElement(D,{charList:this.props.charList,id2char:this.props.id2char,char2id:this.props.char2id,updateChars:this.props.updateChars,mode:this.props.cur_mode,selectedRows:this.props.selectedRows,updateSelectedRows:this.props.updateSelectedRows,updateMode:this.props.updateMode,setField:this.props.setField,getNumAnnotations:this.props.getNumAnnotations})),s.a.createElement("div",{id:"middle-disp"},s.a.createElement("div",{id:"current-selection"},s.a.createElement("h3",null,"Current Selection"),s.a.createElement(H,{value:this.props.selected_text,lockSel:this.props.confirmSelection,clearSel:this.props.clearSel,confirmed:this.props.confirmed})),s.a.createElement("div",{id:"collect-information"},s.a.createElement(T,{cur_info:this.props.cur_info,charList:this.props.charList,id2char:this.props.id2char,char2id:this.props.char2id,infoSubmit:this.props.infoSubmit,cur_mode:this.props.cur_mode,updateMode:this.props.updateMode,setField:this.props.setField,confirmed:this.props.confirmed})))):"Mention"===this.props.cur_info.sel_type?s.a.createElement("div",{id:"collect"},s.a.createElement("div",{id:"charnames"},s.a.createElement("h3",null,"Characters"),s.a.createElement(D,{charList:this.props.charList,id2char:this.props.id2char,char2id:this.props.char2id,updateChars:this.props.updateChars,mode:this.props.cur_mode,selectedRows:this.props.selectedRows,updateSelectedRows:this.props.updateSelectedRows,updateMode:this.props.updateMode,setField:this.props.setField,getNumAnnotations:this.props.getNumAnnotations})),s.a.createElement("div",{id:"middle-disp"},s.a.createElement("div",{id:"current-selection"},s.a.createElement("h3",null,"Current Selection"),s.a.createElement(H,{value:this.props.selected_text,lockSel:this.props.confirmSelection,clearSel:this.props.clearSel,confirmed:this.props.confirmed})),s.a.createElement("div",{id:"collect-information"},s.a.createElement(B,{cur_info:this.props.cur_info,charList:this.props.charList,id2char:this.props.id2char,char2id:this.props.char2id,infoSubmit:this.props.infoSubmit,cur_mode:this.props.cur_mode,updateMode:this.props.updateMode,setField:this.props.setField,confirmed:this.props.confirmed})))):s.a.createElement("div",{id:"collect"},s.a.createElement("div",{id:"charnames"},s.a.createElement("h3",null,"Characters"),s.a.createElement(D,{charList:this.props.charList,id2char:this.props.id2char,char2id:this.props.char2id,updateChars:this.props.updateChars,mode:this.props.cur_mode,selectedRows:this.props.selectedRows,updateSelectedRows:this.props.updateSelectedRows,updateMode:this.props.updateMode,setField:this.props.setField,getNumAnnotations:this.props.getNumAnnotations})),s.a.createElement("div",{id:"middle-disp"},s.a.createElement("div",{id:"current-selection"},s.a.createElement("h3",null,"Current Selection"),s.a.createElement(H,{value:this.props.selected_text,lockSel:this.props.confirmSelection,clearSel:this.props.clearSel,confirmed:this.props.confirmed})),s.a.createElement("div",{id:"collect-information"},s.a.createElement(M,{setSelectionType:this.props.setSelectionType,confirmed:this.props.confirmed})))):s.a.createElement("div",{id:"collect"},s.a.createElement("div",{id:"charnames"},s.a.createElement("h3",null,"Characters"),s.a.createElement(D,{charList:this.props.charList,id2char:this.props.id2char,char2id:this.props.char2id,updateChars:this.props.updateChars,mode:this.props.cur_mode,selectedRows:this.props.selectedRows,updateSelectedRows:this.props.updateSelectedRows,updateMode:this.props.updateMode,setField:this.props.setField,getNumAnnotations:this.props.getNumAnnotations})),s.a.createElement("div",{id:"middle-disp"}))}}]),t}(s.a.Component),M=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return!1===this.props.confirmed?s.a.createElement("div",null):s.a.createElement("div",{id:"selection-type"},s.a.createElement("h3",null,"Select the type of the selection:"),s.a.createElement(b.a,{id:"selection-type",m:-2},s.a.createElement(E.a,{"aria-label":"position",name:"position",value:this.props.value,row:!0,onChange:function(t){return e.props.setSelectionType(t)},fontSize:"fontSize"},s.a.createElement(_.a,{value:"Quote",control:s.a.createElement(v.a,{color:"primary"}),label:"Quote",labelPlacement:"start"}),s.a.createElement(_.a,{value:"Mention",control:s.a.createElement(v.a,{color:"primary"}),label:"Mention",labelPlacement:"start"}))))}}]),t}(s.a.Component),I=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={show:!1},a.onMouseUp=a.onMouseUp.bind(Object(f.a)(a)),a.convertToHtml=a.convertToHtml.bind(Object(f.a)(a)),a.getToolSpan=a.getToolSpan.bind(Object(f.a)(a)),a.handleHoverEnter=a.handleHoverEnter.bind(Object(f.a)(a)),a.handleHoverLeave=a.handleHoverLeave.bind(Object(f.a)(a)),a.getDetailedInfo=a.getDetailedInfo.bind(Object(f.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"getSelectionCharacterOffsetWithin",value:function(e){var t,a=0,n=0,s=e.ownerDocument||e.document,i=s.defaultView||s.parentWindow;if("undefined"!=typeof i.getSelection){if((t=i.getSelection()).rangeCount>0){var r=i.getSelection().getRangeAt(0),o=r.cloneRange();o.selectNodeContents(e),o.setEnd(r.startContainer,r.startOffset),a=o.toString().length,o.setEnd(r.endContainer,r.endOffset),n=o.toString().length}}else if((t=s.selection)&&"Control"!==t.type){var l=t.createRange(),c=s.body.createTextRange();c.moveToElementText(e),c.setEndPoint("EndToStart",l),a=c.text.length,c.setEndPoint("EndToEnd",l),n=c.text.length}return{start:a,end:n}}},{key:"onMouseUp",value:function(e){if(!1===this.props.locked&&"input-text"===e.currentTarget.className){console.log("Text selected.");var t=e.currentTarget,a=this.getSelectionCharacterOffsetWithin(t);a.start!==a.end&&(console.log("Offsets: ",a.start,a.end),this.props.setSelection(a.start,a.end))}}},{key:"handleHoverEnter",value:function(e){var t=e.target.id,a=this.props.getSpanInfo(t),n=this.getToolSpan(a);this.setState({show:!0},function(e,t){var a=e.clientX+"px",n=e.clientY+"px",s=document.createElement("div");s.setAttribute("id","spanModal"),s.setAttribute("style","position:absolute; background-color:LightGray;"),s.style.top=n,s.style.left=a,s.innerHTML=t,document.body.appendChild(s)}(e,n))}},{key:"handleHoverLeave",value:function(e){!0===this.state.show&&this.setState({show:!1},function(e){var t=document.getElementById("spanModal");t.parentNode.removeChild(t)}())}},{key:"getDetailedInfo",value:function(e){var t=this,a={Anaphoric:"Pronominal",Implicit:"Implicit",Explicit:"Named"}[e.quote_type],n=e.speaker.map((function(e){return t.props.id2char[e]})),s=e.speakee.map((function(e){return t.props.id2char[e]})),i=e.ref_exp;return{sel_type:e.sel_type,quote_type:a,speaker:n,speakee:s,ref_exp:i}}},{key:"getToolSpan",value:function(e){var t=this.getDetailedInfo(e);if("Quote"===t.sel_type){var a=t.quote_type,n=t.speaker,s=t.ref_exp;return"<span> <ul><li>Type: "+a+"</li><li>Speaker: "+n+"</li><li>Addressee(s): "+t.speakee.join("; ")+"</li><li>Ref Exp: "+s+"</li></ul></span>"}if("Mention"===t.sel_type)return"<span><ul><li>Mention(s): "+t.speakee.join("; ")+"</li></ul></span>"}},{key:"convertToHtml",value:function(e){var t=this,a=e.texts,n=e.classes,i=e.ids;return a.map((function(e,a){return""!==i[a]?s.a.createElement("span",{className:n[a]+" disable-selection",id:i[a],onMouseUp:t.props.onSpanClick,onMouseEnter:function(e){return t.handleHoverEnter(e)},onMouseLeave:function(e){return t.handleHoverLeave(e)}},e):s.a.createElement("span",{className:n[a]},e)}))}},{key:"render",value:function(){var e=this,t=this.convertToHtml(this.props.value);return s.a.createElement("div",{id:"annotationarea",className:"input-text",onMouseUp:function(t){return e.onMouseUp(t)}},s.a.createElement("span",null,t))}}]),t}(s.a.Component),D=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={expandedRows:[]},a.handleRowClick=a.handleRowClick.bind(Object(f.a)(a)),a.renderItem=a.renderItem.bind(Object(f.a)(a)),a.deleteIcon=a.deleteIcon.bind(Object(f.a)(a)),a.handleDeleteIcon=a.handleDeleteIcon.bind(Object(f.a)(a)),a.checkBox=a.checkBox.bind(Object(f.a)(a)),a.handleCheckBox=a.handleCheckBox.bind(Object(f.a)(a)),a.radioBox=a.radioBox.bind(Object(f.a)(a)),a.handleRadioBox=a.handleRadioBox.bind(Object(f.a)(a)),a.addButton=a.addButton.bind(Object(f.a)(a)),a.handleAddChar=a.handleAddChar.bind(Object(f.a)(a)),a.handleDeleteAlias=a.handleDeleteAlias.bind(Object(f.a)(a)),a.addAliasButton=a.addAliasButton.bind(Object(f.a)(a)),a.handleAddAlias=a.handleAddAlias.bind(Object(f.a)(a)),a.mergeButton=a.mergeButton.bind(Object(f.a)(a)),a.handleMergeClick=a.handleMergeClick.bind(Object(f.a)(a)),a.handleMakeMainName=a.handleMakeMainName.bind(Object(f.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"handleMergeClick",value:function(){"normal"===this.props.mode?this.props.updateMode("merge"):"merge"===this.props.mode&&this.props.setField("merge-chars")}},{key:"handleRowClick",value:function(e){console.log(e);var t=this.state.expandedRows,a=t.includes(e)?t.filter((function(t){return t!==e})):t.concat(e);this.setState({expandedRows:a})}},{key:"handleDeleteIcon",value:function(e){console.log(e);var t=this.props.getNumAnnotations(e.id);if(0!==t)alert("Error! There are "+t+" annotations that still use this character.");else if(!0===window.confirm("Deleting the following character with all aliases: "+e.name)){var a=this.props.charList.filter((function(t){return t.name!==e.name}));this.props.updateChars(a)}}},{key:"deleteIcon",value:function(e){var t=this;return s.a.createElement("span",{id:"delete-button-"+e.id},s.a.createElement("button",{name:"D",onClick:function(){return t.handleDeleteIcon(e)}},"Del"))}},{key:"handleCheckBox",value:function(e){console.log(e.name,e.id);var t=this.props.selectedRows,a=t.includes(e.id);console.log(t,a,Array.isArray(t)),!0===a&&console.log("Handle checkBox "+e.id+" "+e.name);var n=a?t.filter((function(t){return t!==e.id})):t.concat(e.id);console.log("New selected rows: "+n,Array.isArray(n)),this.props.updateSelectedRows(n)}},{key:"checkBox",value:function(e){var t=this,a=!1,n=this.props.selectedRows.includes(e.id);return!0===n&&console.log(e.name+": "+e.id),"normal"!==this.props.mode&&"ref_exp"!==this.props.mode&&"done"!==this.props.mode||(a=!0,n=!1),s.a.createElement("input",{type:"checkbox",disabled:a,checked:n,onClick:function(){return t.handleCheckBox(e)}})}},{key:"handleRadioBox",value:function(e){var t=[].concat(e.id);this.props.updateSelectedRows(t)}},{key:"radioBox",value:function(e){var t=this,a=this.props.selectedRows.includes(e.id);return s.a.createElement("input",{type:"radio",checked:a,onClick:function(){return t.handleRadioBox(e)}})}},{key:"handleDeleteAlias",value:function(e,t){var a=this.props.charList,n=e.expand.filter((function(e){return e.name!==t.name}));a.forEach((function(t){t.id===e.id&&(t.expand=n)})),this.props.updateChars(a)}},{key:"addAliasButton",value:function(e){var t=this;return s.a.createElement("span",null,s.a.createElement("button",{name:"add-alias",onClick:function(){return t.handleAddAlias(e)}},"New"))}},{key:"handleAddAlias",value:function(e){var t=this.props.charList,a=window.prompt("Enter new alias name for "+e.name+" : ");(a=O(a))in this.props.char2id?alert("Name already exists in character list."):(t.forEach((function(t){t.id===e.id&&t.expand.push({name:a,parent:e.id})})),this.props.updateChars(t))}},{key:"getAliasRow",value:function(e){}},{key:"handleMakeMainName",value:function(e,t){var a=this.props.charList.map((function(a){if(a.id===e.id){var n={id:a.id,parent:a.parent,name:t.name},s=a.name,i=a.expand.map((function(e){return e.name===t.name?{name:s,parent:e.parent}:e}));return n.expand=i,n}return a}));this.props.updateChars(a)}},{key:"renderItem",value:function(e){var t=this,a=this.deleteIcon(e),n=null;n="speaker"!==this.props.mode?this.checkBox(e):this.radioBox(e);var i=[s.a.createElement("tr",{key:"row-data-"+e.id},s.a.createElement("td",{className:"td-normal"},n),s.a.createElement("td",{onClick:function(){return t.handleRowClick(e.id)},className:"td-normal row-name"},e.name),s.a.createElement("td",{className:"td-left"},a))];return this.state.expandedRows.includes(e.id)&&(i.push(s.a.createElement("tr",null,s.a.createElement("td",null),s.a.createElement("td",null,s.a.createElement("b",null,"Aliases")),s.a.createElement("td",null,this.addAliasButton(e)))),e.expand.forEach((function(a){i.push(s.a.createElement(L,{item:e,alias:a,handleDeleteAlias:t.handleDeleteAlias,handleMakeMainName:t.handleMakeMainName}))}))),i}},{key:"handleAddChar",value:function(){var e=window.prompt("Enter character name: ");e=O(e);var t=this.props.charList,a=[];t.forEach((function(e,t){a.push(e.id)}));var n=Math.max.apply(Math,a)+1;e in this.props.char2id?alert("Name already exists in character list."):(t.push({name:e,id:n,parent:n,expand:[]}),this.props.updateChars(t))}},{key:"addButton",value:function(){return s.a.createElement("span",null,s.a.createElement("button",{name:"Add-char",onClick:this.handleAddChar,className:"char-top-buttons"},"Add"))}},{key:"mergeButton",value:function(){var e="Merge";return"merge"===this.props.mode&&(e="Submit"),s.a.createElement("span",null,s.a.createElement("button",{name:"Merge-char",onClick:this.handleMergeClick,className:"char-top-buttons"},e))}},{key:"render",value:function(){var e=this;console.log("Rendering character list with: "+this.props.selectedRows.length);var t=[];return this.props.charList.forEach((function(a){var n=e.renderItem(a);t=t.concat(n)})),s.a.createElement("div",{id:"character-list"},s.a.createElement("table",null,s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("td",null,"---"),s.a.createElement("td",{style:{width:"50%"}},this.addButton()),s.a.createElement("td",{style:{width:"75%"}},this.mergeButton()))),s.a.createElement("tbody",null,t)))}}]),t}(s.a.Component),L=function(e){function t(e){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).call(this,e))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"deleteAliasIcon",value:function(e,t){var a=this;return s.a.createElement("span",{id:"delete-button-"+t.name},s.a.createElement("button",{name:"D",onClick:function(){return a.props.handleDeleteAlias(e,t)}},"Del"))}},{key:"makeMainNameIcon",value:function(e,t){var a=this;return s.a.createElement("span",{id:"make-main-"+t.name},s.a.createElement("button",{name:"Main",onClick:function(){a.props.handleMakeMainName(e,t)}},"Main"))}},{key:"render",value:function(){var e=this.props.alias;return s.a.createElement("tr",{key:e.name},s.a.createElement("td",null),s.a.createElement("td",{className:"td-normal"},this.makeMainNameIcon(this.props.item,e)),s.a.createElement("td",{className:"td-alias"},e.name),s.a.createElement("td",null,this.deleteAliasIcon(this.props.item,e)))}}]),t}(s.a.Component),T=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).setQuoteType=a.setQuoteType.bind(Object(f.a)(a)),a.onRefExpSubmit=a.onRefExpSubmit.bind(Object(f.a)(a)),a.onSubmit=a.onSubmit.bind(Object(f.a)(a)),a.onConfirm=a.onConfirm.bind(Object(f.a)(a)),a.onReviewEdit=a.onReviewEdit.bind(Object(f.a)(a)),a.getDetailedInfo=a.getDetailedInfo.bind(Object(f.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"setQuoteType",value:function(e){var t=e.target.value;this.props.setField("quote_type",t)}},{key:"onRefExpSubmit",value:function(){this.props.setField("ref_exp",this.state.ref_exp)}},{key:"onSubmit",value:function(){console.log("Info submitted"),this.props.updateMode("done")}},{key:"onConfirm",value:function(e){this.props.infoSubmit(e)}},{key:"onReviewEdit",value:function(){this.props.updateMode("normal")}},{key:"getDetailedInfo",value:function(e){var t=this,a=e.quote_type,n=e.speaker.map((function(e){return t.props.id2char[e]})),s=e.speakee.map((function(e){return t.props.id2char[e]})),i=e.ref_exp;return{sel_type:e.sel_type,quote_type:a,speaker:n,speakee:s,ref_exp:i}}},{key:"render",value:function(){var e="Implicit"===this.props.cur_info.quote_type||""===this.props.cur_info.quote_type,t=this.getDetailedInfo(this.props.cur_info);return!1===this.props.confirmed?s.a.createElement("div",null):"done"!==this.props.cur_mode?s.a.createElement("div",{id:"quote-info"},s.a.createElement(F,{setQuoteType:this.setQuoteType,value:t.quote_type,mode:this.props.cur_mode}),s.a.createElement(U,{updateMode:this.props.updateMode,value:t.speaker,mode:this.props.cur_mode,setField:this.props.setField}),s.a.createElement(z,{updateMode:this.props.updateMode,value:t.speakee,mode:this.props.cur_mode,setField:this.props.setField,message:"Select Addressee",selType:t.sel_type}),s.a.createElement(P,{updateMode:this.props.updateMode,value:t.ref_exp,mode:this.props.cur_mode,setField:this.props.setField,active:e}),s.a.createElement(Q,{onSubmit:this.onConfirm})):s.a.createElement(J,{speaker:t.speaker,speakee:t.speakee,ref_exp:t.ref_exp,onConfirm:this.onConfirm,onBack:this.onReviewEdit})}}]),t}(s.a.Component),B=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).onReviewEdit=a.onReviewEdit.bind(Object(f.a)(a)),a.onConfirm=a.onConfirm.bind(Object(f.a)(a)),a.onSubmit=a.onSubmit.bind(Object(f.a)(a)),a.getDetailedInfo=a.getDetailedInfo.bind(Object(f.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"onConfirm",value:function(e){this.props.infoSubmit(e)}},{key:"onReviewEdit",value:function(){this.props.updateMode("normal")}},{key:"onSubmit",value:function(){console.log("Info submitted"),this.props.updateMode("done")}},{key:"getDetailedInfo",value:function(e){var t=this,a=e.quote_type,n=e.speaker.map((function(e){return t.props.id2char[e]})),s=e.speakee.map((function(e){return t.props.id2char[e]})),i=e.ref_exp;return{sel_type:e.sel_type,quote_type:a,speaker:n,speakee:s,ref_exp:i}}},{key:"render",value:function(){var e=this.getDetailedInfo(this.props.cur_info);return!1===this.props.confirmed?s.a.createElement("div",null):"done"!==this.props.cur_mode?s.a.createElement("div",{id:"collect-mention"},s.a.createElement(z,{updateMode:this.props.updateMode,value:e.speakee,mode:this.props.cur_mode,setField:this.props.setField,message:"Select Entity being referred to ",selType:e.sel_type}),s.a.createElement(Q,{onSubmit:this.onConfirm})):s.a.createElement(J,{speakee:e.speakee,onConfirm:this.onConfirm,onBack:this.onReviewEdit})}}]),t}(s.a.Component),F=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"border"},s.a.createElement(b.a,{id:"quote-type",m:-2},s.a.createElement("h3",null,"Select Quote Type"),s.a.createElement(E.a,{"aria-label":"position",name:"position",value:this.props.value,row:!0,onChange:function(t){return e.props.setQuoteType(t)},fontSize:"fontSize"},s.a.createElement(_.a,{value:"Implicit",control:s.a.createElement(v.a,{color:"primary"}),label:"Implicit",labelPlacement:"start"}),s.a.createElement(_.a,{value:"Anaphoric",control:s.a.createElement(v.a,{color:"primary"}),label:"Pronominal",labelPlacement:"start"}),s.a.createElement(_.a,{value:"Explicit",control:s.a.createElement(v.a,{color:"primary"}),label:"Named",labelPlacement:"start",fontSize:"fontSize"}))))}}]),t}(s.a.Component),U=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).onEdit=a.onEdit.bind(Object(f.a)(a)),a.onSubmit=a.onSubmit.bind(Object(f.a)(a)),a.onDivClick=a.onDivClick.bind(Object(f.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"onDivClick",value:function(){"speaker"===this.props.mode?this.onSubmit():"normal"===this.props.mode&&this.onEdit()}},{key:"onEdit",value:function(){"normal"===this.props.mode&&this.props.updateMode("speaker")}},{key:"onSubmit",value:function(){"speaker"===this.props.mode&&this.props.setField("speaker")}},{key:"render",value:function(){var e=""===this.props.value?"None set.":this.props.value,t="speaker"===this.props.mode?"green":"black",a="speaker"===this.props.mode;return s.a.createElement("div",{className:"border",id:"select-speaker",onClick:this.onDivClick,style:{cursor:"pointer"}},s.a.createElement("h3",{style:{color:t}},"Select Speaker"),s.a.createElement("div",null,s.a.createElement("i",null,"Select the speaker from the character list on the left, and press Submit when done.")),s.a.createElement("span",null,s.a.createElement("b",null,"Speaker:")," ",e," "),s.a.createElement("span",null,s.a.createElement("button",{type:"submit",name:"speaker-edit",onClick:this.onEdit,disabled:a},"Edit")),s.a.createElement("span",null,s.a.createElement("button",{type:"submit",name:"speaker-ok",onClick:this.onSubmit},"Submit")))}}]),t}(s.a.Component),z=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).onEdit=a.onEdit.bind(Object(f.a)(a)),a.onSubmit=a.onSubmit.bind(Object(f.a)(a)),a.onDivClick=a.onDivClick.bind(Object(f.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"onEdit",value:function(){this.props.updateMode("speakee")}},{key:"onSubmit",value:function(){this.props.setField("speakee")}},{key:"onDivClick",value:function(){"speakee"===this.props.mode?this.onSubmit():"normal"===this.props.mode&&this.onEdit()}},{key:"render",value:function(){var e=""===this.props.value?"None set":this.props.value.join("; "),t="speakee"===this.props.mode?"green":"black",a="speakee"===this.props.mode,n="Mention"===this.props.selType?"Mention(s)":"Addressee(s)";return s.a.createElement("div",{className:"border",id:"select-speakee",onClick:this.onDivClick,style:{cursor:"pointer"}},s.a.createElement("h3",{style:{color:t}},"Select ",n),s.a.createElement("div",null,s.a.createElement("i",null,this.props.message," from the character list on the left, and press Submit when done. If there are multiple, select all possible ones.")),s.a.createElement("span",null,s.a.createElement("b",null,n,"(s):")," ",e," "),s.a.createElement("span",null,s.a.createElement("button",{type:"submit",name:"speakee-edit",onClick:this.onEdit,disabled:a},"Edit")),s.a.createElement("span",null,s.a.createElement("button",{type:"submit",name:"speakee-ok",onClick:this.onSubmit},"Submit")))}}]),t}(s.a.Component),H=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return""===this.props.value?s.a.createElement("div",{id:"current-text"}):s.a.createElement("div",{id:"cur-sel"},s.a.createElement("div",{id:"current-text"},s.a.createElement("p",null,this.props.value),s.a.createElement("form",{className:"lockSel"},s.a.createElement("span",null,s.a.createElement("button",{type:"submit",value:"OK",name:"submit",id:"lock-sel",onClick:this.props.lockSel},"OK")),s.a.createElement("span",null,s.a.createElement("button",{type:"submit",onClick:this.props.clearSel},"Clear")))))}}]),t}(s.a.Component),P=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).onEdit=a.onEdit.bind(Object(f.a)(a)),a.onSubmit=a.onSubmit.bind(Object(f.a)(a)),a.onDivClick=a.onDivClick.bind(Object(f.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"onEdit",value:function(){this.props.updateMode("ref_exp")}},{key:"onSubmit",value:function(){this.props.setField("ref_exp")}},{key:"onDivClick",value:function(){"ref_exp"===this.props.mode?this.onSubmit():"normal"===this.props.mode&&this.onEdit()}},{key:"render",value:function(){var e=""===this.props.value?"None set":this.props.value,t="ref_exp"===this.props.mode?"green":"black",a="ref_exp"===this.props.mode;return this.props.active?null:s.a.createElement("div",{className:"border",id:"select-ref_exp",onClick:this.onDivClick,style:{cursor:"pointer"}},s.a.createElement("h3",{style:{color:t}},"Select Referring Expression"),s.a.createElement("div",null,s.a.createElement("i",null,"Select the referring expression from the text area on the right and click Submit when done.")),s.a.createElement("span",null,s.a.createElement("b",null,"Referring Expression:")," ",e," "),s.a.createElement("span",null,s.a.createElement("button",{type:"submit",name:"speakee-edit",onClick:this.onEdit,disabled:a},"Edit")),s.a.createElement("span",null,s.a.createElement("button",{type:"submit",name:"speakee-ok",onClick:this.onSubmit},"Submit")))}}]),t}(s.a.Component),Q=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("button",{id:"submit-info-button",type:"submit",value:"Submit-info",onClick:this.props.onSubmit},"Submit Info "))}}]),t}(s.a.Component),J=function(e){function t(e){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).call(this,e))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e="";if("ref_exp"in this.props&&(e=this.props.ref_exp),"speaker"in this.props){var t=this.props.speakee.join("; ");return s.a.createElement("div",{id:"display-info"},s.a.createElement("div",{id:"info"},s.a.createElement("h3",null,"Review Quote Information: "),s.a.createElement("ul",null,s.a.createElement("li",null,s.a.createElement("b",null,"Speaker: "),this.props.speaker),s.a.createElement("li",null,s.a.createElement("b",null,"Addressee: "),t),s.a.createElement("li",null,s.a.createElement("b",null,"Referring Expression: "),e))),s.a.createElement("div",null,s.a.createElement("span",null,s.a.createElement("button",{type:"submit",name:"confirm-info",onClick:this.props.onConfirm},"Confirm")),s.a.createElement("span",null,s.a.createElement("button",{type:"submit",name:"edit-info",onClick:this.props.onBack},"Back"))))}return s.a.createElement("div",{id:"display-info"},s.a.createElement("div",{id:"info"},s.a.createElement("h3",null,"Review Mention Information: "),s.a.createElement("ul",null,s.a.createElement("li",null,s.a.createElement("b",null,"Entity: "),this.props.speakee.join("; ")))),s.a.createElement("div",null,s.a.createElement("span",null,s.a.createElement("button",{type:"submit",name:"confirm-info",onClick:this.props.onConfirm},"Confirm")),s.a.createElement("span",null,s.a.createElement("button",{type:"submit",name:"edit-info",onClick:this.props.onBack},"Back"))))}}]),t}(s.a.Component),W=S,G=a(21),X=(a(75),["Alanna","Beck","Bisman","Jovana","Leah","Sanghoon","Sofia","Sol"]);var K=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={status:"names",name_1:"",name_2:""},a.handleNameChange=a.handleNameChange.bind(Object(f.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"handleNameChange",value:function(e){var t=e.target.id,a=e.target.value;console.log(t),"name_1"===t?this.setState({name_1:a}):"name_2"===t&&this.setState({name_2:a})}},{key:"render",value:function(){return s.a.createElement("div",{className:"analyze-main"},s.a.createElement("h1",null,"Analyze Disagreements"),s.a.createElement("div",{id:"get-names"},s.a.createElement("h2",null,"Step 1: Choose Annotator Names: "),s.a.createElement(V,{name_1:this.state.name_1,name_2:this.state.name_2,handleNameChange:this.handleNameChange})),s.a.createElement("div",{id:"steps"},s.a.createElement("span",null,s.a.createElement("h2",null,"Step 2: Check Character Agreement:"),s.a.createElement($,{name_1:this.state.name_1,name_2:this.state.name_2})),s.a.createElement("span",null,s.a.createElement("h2",null,"Step 3: Generate Disagreement Document: "),s.a.createElement(ae,{name_1:this.state.name_1,name_2:this.state.name_2}))))}}]),t}(s.a.Component),V=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).renderItem=a.renderItem.bind(Object(f.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"renderItem",value:function(e){var t=[s.a.createElement("option",{value:""})];return e.forEach((function(e){var a=s.a.createElement("option",{value:e},e);t.push(a)})),t}},{key:"render",value:function(){var e=this.renderItem(X);return s.a.createElement("div",{id:"input-names"},s.a.createElement("span",{className:"name-select"},s.a.createElement("h3",{className:"init-heading"}," Annotator 1: "),s.a.createElement("select",{id:"name_1",value:this.props.name_1,onChange:this.props.handleNameChange},e)),s.a.createElement("span",{className:"name-select"},s.a.createElement("h3",{className:"init-heading"}," Annotator 2: "),s.a.createElement("select",{id:"name_2",value:this.props.name_2,onChange:this.props.handleNameChange},e)))}}]),t}(s.a.Component);function Y(e){return s.a.createElement("span",{className:"loadChar"},s.a.createElement("h3",{className:"init-heading"}," ",e.msg," "),s.a.createElement("input",{type:"file",name:e.name,directory:"",webkitdirectory:"",onChange:e.handleUpload}))}function Z(e){return s.a.createElement("span",{className:"loadFolder"},s.a.createElement("h3",{className:"init-heading"}," ",e.msg," "),s.a.createElement("input",{type:"file",name:e.name,accept:".json",onChange:e.handleUpload}))}var $=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={file_1:"",file_2:"",statusLists:"",indicator:0},a.handleUpload=a.handleUpload.bind(Object(f.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(f.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"handleUpload",value:function(e){for(var t=e.target.name,a={},n=function(t){var n=e.target.files[t],s=e.target.files[t].name,i=new FileReader;"."!==s[0]&&(i.readAsText(n,"UTF-8"),i.onload=function(e){a[s]=e.target.result})},s=0;s<e.target.files.length;s+=1)n(s);"file1"===t?this.setState({file_1:a}):"file2"===t&&this.setState({file_2:a})}},{key:"handleSubmit",value:function(e){var t=this;if(""===this.props.name_1||""===this.props.name_2||this.props.name_2===this.props.name_1)alert("Invalid annotator names selected.");else if(""===this.state.file_1||""===this.state.file_2);else{var a,n=this.props.name_1,s=this.props.name_2,i=(a={},Object(G.a)(a,n,this.state.file_1),Object(G.a)(a,s,this.state.file_2),a);g.a.get("http://127.0.0.1:8080/charStatus",{params:{charLists:i}}).then((function(e){t.setState({statusLists:e.data.statusLists,indicator:e.data.indicator})}))}}},{key:"render",value:function(){return s.a.createElement("div",{id:"charAnalyze"},s.a.createElement("div",{id:"charUpload"},s.a.createElement(Z,{name:"file1",handleUpload:this.handleUpload,msg:"JSON 1: "+this.props.name_1}),s.a.createElement(Z,{name:"file2",handleUpload:this.handleUpload,msg:"JSON 2: "+this.props.name_2}),s.a.createElement("button",{type:"button",onClick:this.handleSubmit},"Submit")),s.a.createElement("div",{id:"charStatus"},s.a.createElement(ee,{statusLists:this.state.statusLists,indicator:this.state.indicator})))}}]),t}(s.a.Component),ee=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).colorMap={0:"red",1:"orange",2:"green"},a.state={expandedRows:[],hidden:!1},a.renderItem=a.renderItem.bind(Object(f.a)(a)),a.handleRowClick=a.handleRowClick.bind(Object(f.a)(a)),a.getAnnRows=a.getAnnRows.bind(Object(f.a)(a)),a.toggleDisplay=a.toggleDisplay.bind(Object(f.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"handleRowClick",value:function(e){var t=this.state.expandedRows,a=t.includes(e)?t.filter((function(t){return t!==e})):t.concat(e);this.setState({expandedRows:a})}},{key:"renderItem",value:function(e){var t=this,a="td-green";0===e.status?a="td-red":1===e.status&&(a="td-orange"),a+=" row-name";var n=[s.a.createElement("tr",{key:"row-data-"+e.id},s.a.createElement("td",{onClick:function(){return t.handleRowClick(e.id)},className:a},e.name))];return this.state.expandedRows.includes(e.id)&&(n.push(s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement("b",null,"Aliases")))),e.expand.forEach((function(t){n.push(s.a.createElement(te,{item:e,alias:t}))}))),n}},{key:"getAnnRows",value:function(){var e=this,t=this.props.statusLists,a=Object.keys(t),n={};return a.forEach((function(a,s){var i=[];t[a].forEach((function(t){var a=e.renderItem(t);i=i.concat(a)})),n[a]=i})),{annRows:n,annNames:a}}},{key:"toggleDisplay",value:function(e){this.setState({hidden:!this.state.hidden})}},{key:"render",value:function(){if(""===this.props.statusLists)return s.a.createElement("div",null);if(1===this.props.indicator)return s.a.createElement("div",null,s.a.createElement("h4",{style:{color:"darkgreen"}},"All names match!"));var e=this.getAnnRows(),t=e.annRows,a=e.annNames,n="charTables";!0===this.state.hidden&&(n+=" hidden");var i="minimize";return!0===this.state.hidden&&(i="show"),s.a.createElement("div",null,s.a.createElement("div",{id:"minimize-button"},s.a.createElement("button",{type:"button",onClick:this.toggleDisplay},i)),s.a.createElement("div",null,s.a.createElement("p",{style:{background:"white",border:"none"}},s.a.createElement("span",{style:{color:"darkred"}},"Red: Main name Mismatch\xa0\xa0"),s.a.createElement("span",{style:{color:"orange"}},"Orange: Alias Mismatch\xa0\xa0"),s.a.createElement("span",{style:{color:"green"}},"Green: All good!\xa0\xa0"))),s.a.createElement("div",{className:n},s.a.createElement("div",null,s.a.createElement("div",null,s.a.createElement("h4",{style:{color:"purple",height:"20px"}},a[0])),s.a.createElement("div",{className:"char-table"},s.a.createElement("table",null,s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("td",null,"---"))),s.a.createElement("tbody",null,t[a[0]])))),s.a.createElement("div",null,s.a.createElement("div",null,s.a.createElement("h4",{style:{color:"purple",height:"20px"}},a[1])),s.a.createElement("div",{className:"char-table"},s.a.createElement("table",null,s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("td",null,"---"))),s.a.createElement("tbody",null,t[a[1]]))))))}}]),t}(s.a.Component),te=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.alias;return s.a.createElement("tr",{key:e.name},s.a.createElement("td",{className:"td-alias"},e.name))}}]),t}(s.a.Component),ae=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={file_1:"",file_2:"",message:""},a.handleUpload=a.handleUpload.bind(Object(f.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(f.a)(a)),a.saveAsFile=a.saveAsFile.bind(Object(f.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"handleUpload",value:function(e){for(var t=e.target.name,a={},n=function(t){var n=e.target.files[t],s=e.target.files[t].name,i=new FileReader;"."!==s[0]&&(i.readAsText(n,"UTF-8"),i.onload=function(e){a[s]=e.target.result})},s=0;s<e.target.files.length;s+=1)n(s);if("file1"===t){var i="Annotations received for "+this.props.name_1;i=this.state.message+"\n"+i,this.setState({file_1:a,message:i})}else if("file2"===t){var r="Annotations received for "+this.props.name_2;r=this.state.message+"\n"+r,this.setState({file_2:a,message:r})}}},{key:"saveAsFile",value:function(e,t){var a=new Blob([e],{type:"application/text"}),n=URL.createObjectURL(a),s=document.createElement("a");s.href=n,s.download=t,s.click()}},{key:"handleSubmit",value:function(e){var t=this;if(""===this.state.file_1||""===this.state.file_2){var a="ERROR: Missing data.";a=this.state.message+"\n"+a,this.setState({message:{msg:a}})}else{var n,s=[this.props.name_1,this.props.name_2],i=(n={},Object(G.a)(n,s[0],this.state.file_1),Object(G.a)(n,s[1],this.state.file_2),n),r="Processing...";r=this.state.message+"\n"+r,this.setState({message:r}),g.a.post("http://127.0.0.1:8080/getDisDoc",i).then((function(e){var a=e.data.content,n=e.data.title;t.saveAsFile(a,n+".txt");var s="Processing Complete!";s=t.state.message+"\n"+s,t.setState({message:s})}))}}},{key:"render",value:function(){var e=this.state.message;return s.a.createElement("div",{id:"zipUpload"},s.a.createElement(Y,{name:"file1",handleUpload:this.handleUpload,msg:"Folder 1: "+this.props.name_1}),s.a.createElement(Y,{name:"file2",handleUpload:this.handleUpload,msg:"Folder 2: "+this.props.name_2}),s.a.createElement("button",{type:"button",onClick:this.handleSubmit},"Submit"),s.a.createElement("div",{id:"foot-msg"},e.split("\n").map((function(e,t){return s.a.createElement("div",{key:t},e)}))))}}]),t}(s.a.Component),ne=K,se=(a(76),function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("div",{id:"main-navbar"},s.a.createElement("span",{className:"nav-el"},s.a.createElement(o.b,{to:"/"},"Home")),s.a.createElement("span",{className:"nav-el"},s.a.createElement(o.b,{to:"/annotate"},"Annotate")),s.a.createElement("span",{className:"nav-el"},s.a.createElement(o.b,{to:"/analyze"},"Analyze")),s.a.createElement("span",{className:"nav-el"},s.a.createElement("a",{href:"https://docs.google.com/document/d/1eBsX2rjdLBkmA-kWB_jHCxC1nmbzinH04WUg9PeN_2A/edit?usp=sharing",target:"_blank"},"Instructions"))),s.a.createElement("div",{className:"home"},s.a.createElement(h.c,null,s.a.createElement(h.a,{exact:!0,path:"/",component:ie}),s.a.createElement(h.a,{exact:!0,path:"/annotate",component:W}),s.a.createElement(h.a,{exact:!0,path:"/analyze",component:ne}))))}}]),t}(s.a.Component)),ie=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{id:"home-content"},s.a.createElement("h1",null,"Annotation Tool"),s.a.createElement("p",{className:"normal-p"},"Welcome! You can go from here to the main annotation page, or analyze previous annotations.",s.a.createElement("br",null),"These options are also available on the top navigation bar at all times."),s.a.createElement("div",{className:"main-options"},s.a.createElement("span",{className:"main-option"},s.a.createElement(o.b,{to:"/annotate"},"Annotate")),s.a.createElement("span",{className:"main-option"},s.a.createElement(o.b,{to:"/analyze"},"Analyze Disagreements"))))}}]),t}(s.a.Component),re=se;r.a.render(s.a.createElement(o.a,null,s.a.createElement(re,null)),document.getElementById("root"))}},[[48,1,2]]]);
//# sourceMappingURL=main.ce4427a9.chunk.js.map